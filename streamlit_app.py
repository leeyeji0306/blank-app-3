import streamlit as st
def display_report():
    """ 'í™˜ê²½ì˜¤ì—¼ì´ ë°”ê¾¸ëŠ” ë¯¸ë˜ì˜ í•™êµìƒí™œ' ë³´ê³ ì„œë¥¼ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ì¶œë ¥ """
    report_text = """
## ğŸ“„ í™˜ê²½ì˜¤ì—¼ì´ ë°”ê¾¸ëŠ” ë¯¸ë˜ì˜ í•™êµìƒí™œ ë³´ê³ ì„œ

### ì„œë¡ , ì²­ì†Œë…„ì˜ í•™êµ ìƒí™œì„ ìœ„í˜‘í•˜ëŠ” í™˜ê²½ì˜¤ì—¼
ì˜¤ëŠ˜ë‚  ì¸ë¥˜ëŠ” ê¸°í›„ìœ„ê¸°ë¼ëŠ” ì‹¬ê°í•œ ë„ì „ì— ì§ë©´í•´ ìˆìŠµë‹ˆë‹¤. ì§€êµ¬ í‰ê· ê¸°ì˜¨ ìƒìŠ¹ì€ ë‹¨ìˆœí•œ ë‚ ì”¨ ë³€í™”ì— ê·¸ì¹˜ì§€ ì•Šê³ , í™ìˆ˜Â·ê°€ë­„ë¿ ì•„ë‹ˆë¼ **í­ì—¼ì„ ì¼ìƒí™”**ì‹œí‚¤ê³  ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ í­ì—¼ì€ ì²­ì†Œë…„ì˜ ê±´ê°•ê³¼ í•™êµìƒí™œì— ì§ì ‘ì ì¸ ë¶€ë‹´ì„ ì£¼ëŠ” ì¤‘ìš”í•œ ë¬¸ì œë¡œ ì§€ì ë©ë‹ˆë‹¤.

*(ì›ë¬¸ ì¸ìš©: '1997ë…„ 8ì›”' ëŒ€ë¹„ '2025ë…„ 8ì›”' í­ì—¼/ëŒ€ê¸°ì§ˆ ì‹¬í™” ì§€ë„ ìë£Œ)*
ì´ ë³´ê³ ì„œëŠ” í™˜ê²½ì˜¤ì—¼ìœ¼ë¡œ ì¸í•œ í•´ìˆ˜ë©´ ìƒìŠ¹ê³¼ í­ì—¼ì˜ ì‹¬í™”, ê·¸ë¦¬ê³  ì´ë¡œ ì¸í•´ ì²­ì†Œë…„ì˜ í•™ìŠµ í™˜ê²½ê³¼ í•™êµìƒí™œì´ ì–´ë–»ê²Œ ë‹¬ë¼ì§ˆì§€, ê·¸ë¦¬ê³  ê·¸ ê²ƒì— ëŒ€í•´ ì–´ë–»ê²Œ ëŒ€ì‘í• ì§€ë¥¼ ì‚´í´ë³´ê³ ì í•©ë‹ˆë‹¤.

---

### ë³¸ë¡  1, ë°ì´í„°ë¡œ í™•ì¸í•œ í™˜ê²½ì˜¤ì—¼ì˜ ì£¼ìš” ì›ì¸
í™˜ê²½ì˜¤ì—¼ì€ ë‹¤ì–‘í•œ ì›ì¸ì—ì„œ ë¹„ë¡¯ë˜ë©°, ì´ëŠ” ì²­ì†Œë…„ì˜ ê±´ê°•ê³¼ í•™êµìƒí™œì—ë„ ì§ì ‘ì ì¸ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.
ìš°ë¦¬ë‚˜ë¼ê°€ ì§ë©´í•œ ì£¼ìš” í™˜ê²½ë¬¸ì œëŠ” **ì“°ë ˆê¸°Â·íê¸°ë¬¼ ì²˜ë¦¬ ë¬¸ì œ(65.6%)**, **ëŒ€ê¸°ì˜¤ì—¼Â·ë¯¸ì„¸ë¨¼ì§€ ë¬¸ì œ(51%)**, **ê³¼ë„í•œ í¬ì¥ê³¼ íí”Œë¼ìŠ¤í‹± ì“°ë ˆê¸° ë°œìƒ(40.4%)** ë“±ì´ ë†’ì€ ë¹„ìœ¨ì„ ì°¨ì§€í•©ë‹ˆë‹¤.

* **ëŒ€ê¸°ì˜¤ì—¼/ë¯¸ì„¸ë¨¼ì§€:** ì²­ì†Œë…„ì˜ **í˜¸í¡ê¸° ì§ˆí™˜** ë° **ì•Œë ˆë¥´ê¸°**ë¥¼ ìœ ë°œí•˜ì—¬ í•™ìŠµ ì§‘ì¤‘ë„ë¥¼ ë–¨ì–´ëœ¨ë¦¬ê³  **ê²°ì„ë¥ **ì„ ë†’ì…ë‹ˆë‹¤. ì•¼ì™¸ ì²´ìœ¡ í™œë™ ìˆ˜í–‰ì„ ì–´ë µê²Œ ë§Œë“­ë‹ˆë‹¤.
* **ì“°ë ˆê¸°/í”Œë¼ìŠ¤í‹±:** í•™êµ ê¸‰ì‹ì— ì‚¬ìš©ë˜ëŠ” ì‹ì¬ë£Œì˜ ì•ˆì „ì„±ê³¼ í’ˆì§ˆì—ë„ ì˜í–¥ì„ ë¯¸ì³ ì²­ì†Œë…„ë“¤ì˜ ê±´ê°•í•œ ì‹ìŠµê´€ í˜•ì„±ì— ë¶€ì •ì ì¸ ìš”ì¸ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê²°êµ­ í™˜ê²½ì˜¤ì—¼ì€ ì²­ì†Œë…„ì˜ í•™êµìƒí™œì„ **ì‹ ì²´ì , ì •ì‹ ì , ìƒí™œìŠµê´€ì  ì¸¡ë©´ì—ì„œ ëª¨ë‘ ì œì•½**í•˜ê³  ìˆìœ¼ë©°, ê¸°í›„ìœ„ê¸°ì™€ ë§ë¬¼ë ¤ ê·¸ ì˜í–¥ì€ ë”ìš± ì‹¬í™”ë  ê°€ëŠ¥ì„±ì´ í½ë‹ˆë‹¤.

---

### ë³¸ë¡  2, í­ì—¼ì´ ì²­ì†Œë…„ì˜ í•™ì—…ê³¼ ê±´ê°•ì— ë¯¸ì¹˜ëŠ” ì˜í–¥
í­ì—¼ì€ ì²­ì†Œë…„ì˜ í•™ìŠµ í™œë™ ì „ë°˜ì— ì‹¬ê°í•œ ìœ„í˜‘ì´ ë©ë‹ˆë‹¤.

#### ğŸ“ í•™ì—… ì„±ì·¨ë„ ì €í•˜
* **ì—°êµ¬ ê²°ê³¼:** ë¯¸êµ­ ë‰´ìš•ì‹œ ê³µë¦½ ê³ ë“±í•™ìƒ ì•½ 100ë§Œ ëª…ì„ ë¶„ì„í•œ ê²°ê³¼, ê¸°ì˜¨ì´ **21Â°Cì—ì„œ 32Â°Cë¡œ ìƒìŠ¹**í•  ë•Œ ì‹œí—˜ ì„±ì ì€ í‰ê·  **15% í•˜ë½**í–ˆê³ , ê³¼ëª© í†µê³¼ìœ¨ì€ **10.9% ê°ì†Œ**, ì¡¸ì—… ê°€ëŠ¥ì„±ë„ **2.5%p** ë‚®ì•„ì¡ŒìŠµë‹ˆë‹¤.

#### ğŸ§  ì •ì‹  ê±´ê°• ìœ„í—˜ ì¦ê°€
* **ìì‚´ ì¶©ë™/í–‰ë™:** êµ­ë‚´ì™¸ ì—°êµ¬ì— ë”°ë¥´ë©´ í•˜ë£¨ í‰ê·  ê¸°ì˜¨ì´ **1Â°C ë†’ì•„ì§ˆ ë•Œë§ˆë‹¤** ì²­ì†Œë…„ì˜ ìì‚´ ì¶©ë™ì´ë‚˜ í–‰ë™ìœ¼ë¡œ ì¸í•œ ì‘ê¸‰ì‹¤ ë°©ë¬¸ ê±´ìˆ˜ê°€ **1.3% ì¦ê°€**í•˜ëŠ” ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.
* **ìš°ìš¸/ë¶ˆì•ˆ:** í­ì—¼ ê°•ë„ê°€ 1ë‹¨ìœ„ ì¦ê°€í•  ë•Œë§ˆë‹¤ **ìš°ìš¸ì¦ ë°œìƒë¥ ì€ 13%**, **ë¶ˆì•ˆ ë°œìƒë¥ ì€ 12%** ì¦ê°€í–ˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ì •ì‹ ì  ë¶€ë‹´ì€ ì²­ì†Œë…„ì˜ í•™ì—… ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ì‹¬í™”ì‹œí‚µë‹ˆë‹¤.
* **ê¸°í›„ ë¶ˆì•ˆ (Climate Anxiety):** ì´ë¯¸ í•™ì—… ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ë†’ì€ ì²­ì†Œë…„ë“¤ì—ê²Œ ê¸°í›„ ë³€í™”ì— ëŒ€í•œ ë¶ˆì•ˆê°ì´ ë”í•´ì ¸ ì‹¬ë¦¬ì  ì••ë°•ì´ ì»¤ì§€ë©°, ì´ëŠ” ë¯¸ë˜ í•™ìŠµ ë° ì§„ë¡œì—ë„ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.

#### ğŸƒ ì‹ ì²´ì  ê±´ê°• ë¬¸ì œ
* **í•™êµìƒí™œ ì§ˆ ì €í•˜:** êµì‹¤ ì˜¨ë„ ìƒìŠ¹ìœ¼ë¡œ ì¸í•œ ë‘í†µ, ì¡¸ìŒ, íƒˆìˆ˜ ì¦ì„¸ëŠ” í•™ì—… ì„±ì·¨ë„ ì €í•˜ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤. í­ì—¼ìœ¼ë¡œ ì¸í•œ ì•¼ì™¸ ì²´ìœ¡ ìˆ˜ì—… ì·¨ì†ŒëŠ” ì²­ì†Œë…„ì˜ ì‹ ì²´ ë°œë‹¬ ê¸°íšŒ ë¶€ì¡±ì„ ì´ˆë˜í•©ë‹ˆë‹¤.

---

### ê²°ë¡ , ì§€ì† ê°€ëŠ¥í•œ ë¯¸ë˜ë¥¼ ìœ„í•œ ì²­ì†Œë…„ê³¼ í•™êµì˜ ì—­í• 
í™˜ê²½ì˜¤ì—¼ê³¼ ê¸°í›„ìœ„ê¸°ëŠ” ì²­ì†Œë…„ì˜ í•™ìŠµ í™˜ê²½ì„ ìœ„í˜‘í•˜ëŠ” ì¤‘ìš”í•œ ìš”ì†Œì…ë‹ˆë‹¤. í•´ìˆ˜ë©´ ìƒìŠ¹ê³¼ í­ì—¼ ì‹¬í™”ëŠ” ë‹¨ìˆœí•œ ìì—°í˜„ìƒì´ ì•„ë‹ˆë¼, ë¯¸ë˜ì˜ í•™êµìƒí™œì„ ë³€í™”ì‹œí‚¤ëŠ” ì§ì ‘ì  ì›ì¸ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¾Œì í•˜ê³  ì•ˆì „í•œ í•™ìŠµ í™˜ê²½ì„ ì§€í‚¤ê¸° ìœ„í•œ **ì²­ì†Œë…„ ìŠ¤ìŠ¤ë¡œì˜ ì‹¤ì²œ**ê³¼ **í•™êµ/ì‚¬íšŒ ì „ì²´ì˜ ì œë„ì  ëŒ€ì‘**ì´ ë™ì‹œì— í•„ìš”í•©ë‹ˆë‹¤.

#### ğŸ§‘â€ğŸ¤â€ğŸ§‘ í•™ìƒ ì°¨ì›ì˜ ì‹¤ì²œ
* **ì—ë„ˆì§€ ì ˆì•½:** ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì „ìì œí’ˆ ì „ì› ë„ê¸°, ìƒ¤ì›Œ ì‹œê°„ ì¤„ì´ê¸°.
* **ì¹œí™˜ê²½ ì†Œë¹„:** í…€ë¸”ëŸ¬, ì¥ë°”êµ¬ë‹ˆ ì´ìš©, ë‚¨ì€ ìŒì‹ ì¬í™œìš©í•˜ê¸°.
* **ì¹œí™˜ê²½ ì´ë™:** ëŒ€ì¤‘êµí†µ ë° ìì „ê±° ì´ìš©í•˜ê¸°.

#### ğŸ« í•™êµ/ì œë„ ì°¨ì›ì˜ ëŒ€ì•ˆ
* **êµìœ¡ ëª¨ë¸:** ì§€ì—­ë³„Â·í•™êµë³„ íŠ¹ì„±ì— ë§ëŠ” **ë§ì¶¤í˜• í™˜ê²½êµìœ¡** ê°•í™”, ê¸°í›„ìœ„ê¸° ëŒ€ì‘ ì—­ëŸ‰ì„ í‚¤ìš¸ ìˆ˜ ìˆëŠ” **ì²´í—˜ ì¤‘ì‹¬ í•™ìŠµ í™•ëŒ€**.
* **ì‹œì„¤ ê°œì„ :** í•™êµ ê±´ë¬¼ì˜ **ê·¸ë¦° ë¦¬ëª¨ë¸ë§**ìœ¼ë¡œ ì—ë„ˆì§€ íš¨ìœ¨ ê°œì„ , í­ì—¼ ëŒ€ë¹„ **ì¿¨ë§ ìŠ¤í˜ì´ìŠ¤(Cooling Space) í™•ë³´**.
* **ê¸‰ì‹/ìš´ì˜:** ì¹œí™˜ê²½ ê¸‰ì‹ ì‹œìŠ¤í…œ ë„ì…, **íƒ„ì†Œ ì¤‘ë¦½ í•™êµ ì„ ì–¸** ë° ì—ë„ˆì§€ ê´€ë¦¬ ì‹œìŠ¤í…œ ë„ì….

ë¯¸ë˜ì˜ í•™êµìƒí™œì´ ì§€ì† ê°€ëŠ¥í•˜ê³  ì•ˆì „í•˜ë ¤ë©´, ì²­ì†Œë…„ í•œ ëª… í•œ ëª…ì˜ ì‹¤ì²œê³¼ ë”ë¶ˆì–´ ì‚¬íšŒ ì „ì²´ê°€ **ì£¼ ì—ë„ˆì§€ë¥¼ ì¹œí™˜ê²½ì ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆëŠ” ë¦¬ë”ì‹­**ì„ ë°œíœ˜í•´ì•¼ í•©ë‹ˆë‹¤. ì´ëŠ” ë‹¤ìŒ ì„¸ëŒ€ë¥¼ ìœ„í•œ ì±…ì„ ìˆëŠ” ì„ íƒì´ ë  ê²ƒì…ë‹ˆë‹¤.

---

### ì°¸ê³  ìë£Œ
- ê¸°ìƒì²­ ê¸°ìƒìë£Œê°œë°©í¬í„¸, í­ì—¼ì¼ìˆ˜ ë¶„í¬ë„
- ì—°í•©ë‰´ìŠ¤, ê°€ì¥ ì‹œê¸‰í•œ í™˜ê²½ë¬¸ì œëŠ”â€¦2ë…„ ì—°ì† 'ì“°ë ˆê¸°Â·íê¸°ë¬¼ ì²˜ë¦¬' ê¼½í˜€(2022-04-10)
- [ë§í¬ 1](https://pmc.ncbi.nlm.nih.gov/a)
- [í•œê²¨ë ˆ ê¸°ì‚¬](https://www.hani.co.kr/arti/hanihealth/healthlife/1212006.html)
- [UNSW ê¸°ì‚¬](https://www.unsw.edu.au/newsroom/news/2024/10/rise-in-suicidal-behaviours-among-young-people-linked-to-hotter-temperatures)
- [ë§í¬ 2](https://pmc.ncbi.nlm.nih.gov/articles/PMC7983931/)
"""
    st.markdown(report_text, unsafe_allow_html=True)

# -----------------------------
# ì‚¬ì´ë“œë°”
# -----------------------------
with st.sidebar:
    st.header("ì˜µì…˜")
    st.caption("â€» ëª¨ë“  ë¼ë²¨ì€ í•œêµ­ì–´, ì˜¤ëŠ˜ ì´í›„ ë°ì´í„°ëŠ” ìë™ ì œê±°ë©ë‹ˆë‹¤.")
    # (íƒ­ 1, íƒ­ 2ì˜ ì‚¬ì´ë“œë°” ì˜µì…˜ì€ ê¸°ì¡´ëŒ€ë¡œ ìœ ì§€)

# -----------------------------
# íƒ­ êµ¬ì„±
# -----------------------------
tab1, tab2, tab3, tab4, tab5 = st.tabs([
    "ğŸ“¡ ê³µê°œ ë°ì´í„° ëŒ€ì‹œë³´ë“œ", 
    "ğŸ“˜ ì‚¬ìš©ì ì…ë ¥ ëŒ€ì‹œë³´ë“œ", 
    "ğŸ§  ê¸°í›„ìœ„ê¸° & ì²­ì†Œë…„ ì •ì‹ ê±´ê°•(ì—°êµ¬ì°¸ê³ )", 
    "ğŸ“š ê¸°í›„ìœ„ê¸° & ì²­ì†Œë…„ í•™ì—…(ì—°êµ¬ì°¸ê³ )",
    "ğŸŒ± ê¸°í›„ìœ„ê¸°, ìš°ë¦¬ì˜ ë¯¸ë˜" # â˜…ìƒˆë¡œìš´ íƒ­ ì¶”ê°€
])

# (íƒ­ 1, íƒ­ 2, íƒ­ 3, íƒ­ 4ì˜ ë‚´ìš©ì€ ìœ„ í•¨ìˆ˜ í˜¸ì¶œê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€)
with tab1:
    st.subheader("ì„œìš¸ ì¼ë³„ ê¸°ì˜¨ & í­ì—¼ì¼ (NASA POWER)")
    st.caption("ì¶œì²˜: NASA POWER API (T2M/T2M_MAX). API ì‹¤íŒ¨ ì‹œ ì˜ˆì‹œ ë°ì´í„°ë¡œ ëŒ€ì²´ í‘œì‹œë©ë‹ˆë‹¤.")

    colA, colB, colC = st.columns(3)
    with colA:
        start_date = st.date_input("ì¡°íšŒ ì‹œì‘ì¼", value=date(2015,1,1), min_value=date(1981,1,1), max_value=TODAY_DATE)
    with colB:
        end_date = st.date_input("ì¡°íšŒ ì¢…ë£Œì¼", value=TODAY_DATE, min_value=start_date, max_value=TODAY_DATE)
    with colC:
        hw_threshold = st.number_input("í­ì—¼ ê¸°ì¤€(ì¼ìµœê³ ê¸°ì˜¨, â„ƒ)", min_value=30.0, max_value=40.0, value=33.0, step=0.5)

    data = fetch_nasa_power_daily(start=start_date.isoformat(), end=end_date.isoformat())
    if data["fallback"].any():
        st.warning("API í˜¸ì¶œ ì‹¤íŒ¨ë¡œ ì˜ˆì‹œ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤. (ë„¤íŠ¸ì›Œí¬/ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ í•„ìš”)")

    hw = make_heatwave_flags(data, threshold_max=hw_threshold)
    std = pd.concat([data[["date","value","group"]], hw[["date","value","group"]]], ignore_index=True)
    std = clean_standardize(std, "date", "value", "group")

    if not std.empty:
        min_d = pd.to_datetime(std["date"]).min().date()
        max_d = pd.to_datetime(std["date"]).max().date()
        
        with st.sidebar:
            st.markdown("#### ê³µê°œ ë°ì´í„° ê¸°ê°„ í•„í„°")
            rng = st.slider("í‘œì‹œ ê¸°ê°„ ì„ íƒ", min_value=min_d, max_value=max_d, value=(min_d, max_d), key="tab1_rng")
            smooth_win = st.select_slider("ì´ë™í‰ê·  ìœˆë„ìš°(ì¼, ê¸°ì˜¨ì—ë§Œ ì ìš©)", options=[1,3,5,7,14], value=3, key="tab1_smooth")
        
        std = std[(std["date"] >= rng[0]) & (std["date"] <= rng[1])]
        
        if smooth_win > 1 and not std.empty:
            gtemp = std["group"].isin(["ì¼ í‰ê· ê¸°ì˜¨(â„ƒ)","ì¼ ìµœê³ ê¸°ì˜¨(â„ƒ)"])
            std.loc[gtemp, "value"] = (
                std[gtemp]
                .sort_values("date")
                .groupby("group")["value"]
                .transform(lambda s: s.rolling(smooth_win, min_periods=1).mean())
            )

    plot_line(std[std["group"].isin(["ì¼ í‰ê· ê¸°ì˜¨(â„ƒ)", "ì¼ ìµœê³ ê¸°ì˜¨(â„ƒ)"])], "ì¼ë³„ ê¸°ì˜¨ ì¶”ì´", "ê¸°ì˜¨(â„ƒ)")
    msum = monthly_summary(pd.concat([data[["date","value","group"]], hw], ignore_index=True))
    monthly_heat = msum[msum["group"].str.startswith("í­ì—¼ì¼")]
    monthly_temp = msum[~msum["group"].str.startswith("í­ì—¼ì¼")]
    plot_bar(monthly_heat, "ì›”ë³„ í­ì—¼ì¼ìˆ˜(í•©ê³„)", "í­ì—¼ì¼ìˆ˜(ì¼)")
    plot_line(monthly_temp, "ì›”ë³„ í‰ê·  ê¸°ì˜¨/ìµœê³ ê¸°ì˜¨(í‰ê· )", "ê¸°ì˜¨(â„ƒ)")

    add_risk_annotation()
    st.info("â€» ë³¸ ëŒ€ì‹œë³´ë“œëŠ” **ê¸°ì˜¨Â·í­ì—¼ê³¼ ì •ì‹ ê±´ê°• ì§€í‘œ ê°„ ìƒê´€ì„±**ì— ëŒ€í•œ ì°¸ê³  íƒìƒ‰ìš©ì…ë‹ˆë‹¤. ì¸ê³¼ê´€ê³„ë¥¼ ë‹¨ì •í•˜ì§€ ì•Šìœ¼ë©°, ì§€ì—­Â·ì—°ë ¹Â·ì œë„ ì°¨ì´ì— ë”°ë¼ ê²°ê³¼ í•´ì„ì— ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.")

    st.markdown("#### ì „ì²˜ë¦¬ëœ í‘œ ë‹¤ìš´ë¡œë“œ")
    download_button_for_df(std[["date","value","group"]].sort_values(["date","group"]), "nasa_power_standardized.csv", "CSV ë‹¤ìš´ë¡œë“œ (ê³µê°œ ë°ì´í„°)")
    st.caption("ì£¼ì„: NASA POWER API ë¬¸ì„œ URLì€ ì½”ë“œ ì£¼ì„ì— ê¸°ì¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤. (ì•± ìƒë‹¨ ì£¼ì„ ì°¸ì¡°)")

with tab2:
    st.subheader("ì‚¬ìš©ì ì…ë ¥ ë°ì´í„° ëŒ€ì‹œë³´ë“œ â€” í­ì—¼ì¼ìˆ˜(ì—°ë„Â·ì›”)")
    st.caption("í”„ë¡¬í”„íŠ¸ë¡œ ì œê³µëœ í‘œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤. ì—…ë¡œë“œë‚˜ ì¶”ê°€ ì…ë ¥ì„ ìš”êµ¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")

    user_long, user_year = load_user_table()

    if not user_long.empty:
        y_min = int(pd.to_datetime(user_long["date"]).dt.year.min())
        y_max = int(pd.to_datetime(user_long["date"]).dt.year.max())
        with st.sidebar:
            st.markdown("#### ì‚¬ìš©ì ë°ì´í„° ê¸°ê°„/ìŠ¤ë¬´ë”©")
            y_start, y_end = st.slider("í‘œì‹œ ì—°ë„ ë²”ìœ„", min_value=y_min, max_value=y_max, value=(y_min, y_max), key="tab2_yr_rng")
            smooth_months = st.select_slider("ì›” ì´ë™í‰ê· (ì—°ë„ë³„ ì ìš©)", options=[1,3], value=1, key="tab2_smooth")

        view_df = user_long[(pd.to_datetime(user_long["date"]).dt.year >= y_start) & (pd.to_datetime(user_long["date"]).dt.year <= y_end)]
    else:
        view_df = user_long
        smooth_months = 1 

    if smooth_months > 1 and not view_df.empty:
        view_df = view_df.sort_values(["group","date"]).copy()
        view_df["value"] = view_df.groupby("group")["value"].transform(lambda s: s.rolling(smooth_months, min_periods=1).mean())

    plot_user_monthly(view_df)
    st.markdown("---")
    plot_user_rank(user_year)

    st.markdown("#### ì „ì²˜ë¦¬ëœ í‘œ (í‘œì¤€í™”: date, value, group)")
    st.dataframe(view_df.sort_values(["date","group"]), use_container_width=True)
    download_button_for_df(view_df.sort_values(["date","group"]), "user_heatdays_standardized.csv", "CSV ë‹¤ìš´ë¡œë“œ (ì‚¬ìš©ì ë°ì´í„°)")

with tab3:
    st.subheader("ê¸°í›„ìœ„ê¸° & ì²­ì†Œë…„ ì •ì‹ ê±´ê°•(ì—°êµ¬ ì°¸ê³ )")
    st.caption("ê¸°ì˜¨ ë³€í™”ì™€ ì •ì‹ ê±´ê°• ì§€í‘œì˜ ìƒê´€ê´€ê³„ ì—°êµ¬ ê²°ê³¼ ë° í•œêµ­ ì²­ì†Œë…„ í˜„í™© í†µê³„ë¥¼ ê°„ì ‘ ì§€í‘œë¡œ í™œìš©í•©ë‹ˆë‹¤.")

    research_df, kyrbs_df = get_mental_health_indicators()

    st.markdown("#### ğŸŒ¡ï¸ ê¸°ì˜¨ ë³€í™”ì™€ ì •ì‹ ê±´ê°• ìœ„í—˜ë„ ì¦ê°€ (ì£¼ìš” ì—°êµ¬ ì¸ìš©)")
    
    col1, col2, col3 = st.columns(3)
    with col1:
        st.metric(
            label=f"{research_df.iloc[0]['ì§€í‘œ']} ({research_df.iloc[0]['ì„¤ëª…']})",
            value=f"+{research_df.iloc[0]['ê°’']}{research_df.iloc[0]['ë‹¨ìœ„']}",
            help=f"ì¶œì²˜: {research_df.iloc[0]['ì¶œì²˜']}"
        )
    with col2:
        st.metric(
            label=f"{research_df.iloc[1]['ì§€í‘œ']} ({research_df.iloc[1]['ì„¤ëª…']})",
            value=f"+{research_df.iloc[1]['ê°’']}{research_df.iloc[1]['ë‹¨ìœ„']}",
            help=f"ì¶œì²˜: {research_df.iloc[1]['ì¶œì²˜']}"
        )
    with col3:
        st.metric(
            label=f"{research_df.iloc[2]['ì§€í‘œ']} ({research_df.iloc[2]['ì„¤ëª…']})",
            value=f"+{research_df.iloc[2]['ê°’']}{research_df.iloc[2]['ë‹¨ìœ„']}",
            help=f"ì¶œì²˜: {research_df.iloc[2]['ì¶œì²˜']}"
        )

    st.markdown("---")
    
    st.markdown("#### ğŸ‡°ğŸ‡· í•œêµ­ ì²­ì†Œë…„ ì •ì‹ ê±´ê°• í˜„í™© ì¶”ì´ (KYRBS ê¸°ë°˜ ì˜ˆì‹œ)")
    plot_kyrbs_trend(kyrbs_df)

    st.markdown("#### ğŸ’¡ ë°ì´í„° ìœ ì˜ ì‚¬í•­ ë° ì—°êµ¬ ì¶œì²˜")
    st.warning(
        "**ì£¼ì˜:** ì´ íƒ­ì˜ ë°ì´í„°ëŠ” ì‹¤ì œ ê³µê°œ ì‹œê³„ì—´ì´ ì•„ë‹Œ **ì—°êµ¬ ì¸ìš© ë° ì„ì˜ë¡œ ìƒì„±ëœ ì˜ˆì‹œ ë°ì´í„°**ì…ë‹ˆë‹¤. ì¸ê³¼ê´€ê³„ ë‹¨ì •ì„ í”¼í•˜ê³  ì°¸ê³  ì§€í‘œë¡œë§Œ í™œìš©í•´ì•¼ í•©ë‹ˆë‹¤."
    )
    with st.expander("ì°¸ê³  ë¬¸í—Œ (ì£¼ì„)", expanded=False):
        st.markdown(
            """
            * **ê¸°ì¡´ ì—°êµ¬ (ì²­ì†Œë…„ ìì‚´ì¶©ë™ vs ê¸°ì˜¨):** PubMed: https://pubmed.ncbi.nlm.nih.gov/39441101/
            * **í­ì—¼ vs ìš°ìš¸ì¦/ë¶ˆì•ˆ (ì¤‘êµ­ ì²­ì†Œë…„):** Journal of Affective Disorders (2024). 
            * **ê¸°ì˜¨ 1Â°Câ†‘ vs ìš°ìš¸ ì¦ìƒ (í•œêµ­ ì„±ì¸ 19-40ì„¸):** PubMed (2024). 
            * **í•œêµ­ ì²­ì†Œë…„ ì •ì‹ ê±´ê°• í˜„í™©:** ì²­ì†Œë…„ê±´ê°•í–‰íƒœì¡°ì‚¬(KYRBS)ì˜ ê³µí‘œ í†µê³„ë¥¼ ì°¸ê³ í•˜ì—¬ ì„ì˜ì˜ ì‹œê³„ì—´ ì˜ˆì‹œ ë°ì´í„°ë¥¼ ìƒì„±í–ˆìŠµë‹ˆë‹¤.
            """
        )

with tab4:
    st.subheader("ğŸ“š ê¸°í›„ìœ„ê¸° & ì²­ì†Œë…„ í•™ì—… ì„±ì·¨ë„(ì—°êµ¬ ì°¸ê³ )")
    st.caption("ê³ ì˜¨ í™˜ê²½ì´ í•™ìƒë“¤ì˜ í•™ìŠµ ëŠ¥ë ¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë‹¤ë£¨ëŠ” í•´ì™¸ ì—°êµ¬ ê²°ê³¼ë¥¼ ì¸ìš©í•˜ê³ , ê°€ìƒ ì§€í‘œë¥¼ í†µí•´ ì˜í–¥ì„ íƒìƒ‰í•©ë‹ˆë‹¤.")

    academic_df, academic_melted_df = get_academic_indicators()
    
    # 1. ì£¼ìš” ì—°êµ¬ ì¸ìš© ìš”ì•½
    st.markdown("#### ğŸŒ¡ï¸ ê³ ì˜¨ ë…¸ì¶œê³¼ í•™ì—… ì„±ì·¨ë„ í•˜ë½ (ì£¼ìš” ì—°êµ¬ ì¸ìš©)")
    
    col_í•™ì—…1, col_í•™ì—…2, col_í•™ì—…3 = st.columns(3)
    
    with col_í•™ì—…1:
        st.metric(
            label=f"{academic_df.iloc[0]['ì§€í‘œ']} ({academic_df.iloc[0]['ì„¤ëª…']})",
            value=f"-{academic_df.iloc[0]['ê°’']}{academic_df.iloc[0]['ë‹¨ìœ„']}",
            help=f"ì¶œì²˜: {academic_df.iloc[0]['ì¶œì²˜']}"
        )
    with col_í•™ì—…2:
        st.metric(
            label="ì—°êµ¬ ì¸ìš©",
            value="ğŸ‘‡",
            help="ì—¬ë¦„ì²  ë”ìœ„ê°€ í•™ìƒë“¤ì˜ í•™ìŠµ ì§‘ì¤‘ë ¥ê³¼ ê¸°ì–µë ¥ì— ë¶€ì •ì  ì˜í–¥ì„ ë¯¸ì¹¨"
        )
    with col_í•™ì—…3:
        # ê°€ìƒì˜ ì§€í‘œë¡œ ì±„ìš°ê¸°
        st.metric(
            label="ê³ ì˜¨ í•™ìŠµ ì†ì‹¤ ì§€ìˆ˜",
            value=f"{academic_melted_df[academic_melted_df['ì—°ë„'] == academic_melted_df['ì—°ë„'].max()]['value'].iloc[0].round(1)}",
            delta=f"{(academic_melted_df[academic_melted_df['ì—°ë„'] == academic_melted_df['ì—°ë„'].max()]['value'].iloc[0] - academic_melted_df[academic_melted_df['ì—°ë„'] == academic_melted_df['ì—°ë„'].min()]['value'].iloc[0]).round(1)}",
            delta_color="inverse", # ê°’ì´ ë†’ì„ìˆ˜ë¡ ìœ„í—˜í•˜ë¯€ë¡œ ë°˜ì „
            help="ê°€ìƒ ì§€í‘œ: ìµœê·¼ ì—°ë„ 'ê³ ì˜¨ í•™ìŠµ ì†ì‹¤ ì§€ìˆ˜' (ìµœì†Œ ì—°ë„ ëŒ€ë¹„ ë³€í™”)"
        )

    st.markdown("---")

    # 2. ê°€ìƒ ì‹œê³„ì—´ ì§€í‘œ ì‹œê°í™”
    st.markdown("#### ğŸ“ˆ ê³ ì˜¨ ë…¸ì¶œ ê´€ë ¨ ê°€ìƒ í•™ì—… ì§€í‘œ ì¶”ì´")
    plot_academic_trend(academic_melted_df)


    # 3. ìƒì„¸ ì—°êµ¬ ì¶œì²˜ ë° ìœ ì˜ ì‚¬í•­
    st.markdown("#### ğŸ’¡ ë°ì´í„° ìœ ì˜ ì‚¬í•­ ë° ì—°êµ¬ ì¶œì²˜")
    st.warning(
        "**ì£¼ì˜:** ì´ íƒ­ì˜ ë°ì´í„°ëŠ” ì‹¤ì œ í•œêµ­ì˜ í•™ì—… ì„±ì  í†µê³„ê°€ ì•„ë‹Œ, **í•´ì™¸ ì—°êµ¬ ì¸ìš© ë° ê³ ì˜¨ ì˜í–¥ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê°€ì •í•œ ì„ì˜ì˜ ì‹œê³„ì—´ ì˜ˆì‹œ ë°ì´í„°**ì…ë‹ˆë‹¤. "
        "ê¸°ì˜¨ ìƒìŠ¹ê³¼ í•™ì—… ì„±ì  í•˜ë½ì˜ **ìƒê´€ê´€ê³„**ë¥¼ ì°¸ê³ í•˜ëŠ” ìš©ë„ë¡œë§Œ í™œìš©í•´ì•¼ í•©ë‹ˆë‹¤."
    )
    with st.expander("ì°¸ê³  ë¬¸í—Œ (ì£¼ì„)", expanded=False):
        st.markdown(
            """
            * **ê¸°ì˜¨ 1Â°Câ†‘ vs í•™ì—… ì„±ì·¨ë„ í•˜ë½:** AERJ (2020) ë…¼ë¬¸ ë“±. ì—ì–´ì»¨ì´ ì—†ëŠ” ë¯¸êµ­ êµì‹¤ ëŒ€ìƒ ì—°êµ¬ì—ì„œ ê³ ì˜¨ ë…¸ì¶œê³¼ í•™ì—… ì„±ì·¨ë„ í•˜ë½ ê°„ì˜ ìœ ì˜ë¯¸í•œ ìƒê´€ê´€ê³„ ë°œê²¬.
            * **ê°€ìƒ ì§€í‘œ:** ê³ ì˜¨ í•™ìŠµ ì†ì‹¤ ì§€ìˆ˜ ë° í•™ì—… ì„±ì·¨ë„ ë³€í™”ìœ¨ì€ **í•´ë‹¹ ì—°êµ¬ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì˜í–¥ì„ ì‹œë®¬ë ˆì´ì…˜í•œ ì„ì˜ì˜ ê°’**ì…ë‹ˆë‹¤.
            """
        )

with tab5: # â˜…ìƒˆë¡œ ì¶”ê°€ëœ 'ê¸°í›„ìœ„ê¸°, ìš°ë¦¬ì˜ ë¯¸ë˜' íƒ­
    st.subheader("ğŸŒ± ê¸°í›„ìœ„ê¸°, ìš°ë¦¬ì˜ ë¯¸ë˜: ì²­ì†Œë…„ê³¼ í•™êµì˜ ëŒ€ì‘ ë°©ì•ˆ")
    st.caption("ê¸°í›„ìœ„ê¸°ì˜ ì˜í–¥ì„ ë„˜ì–´, í•™ìƒë“¤ì´ ì§ì ‘ ì‹¤ì²œí•˜ê³  í•™êµê°€ ë³€í™”í•´ì•¼ í•  êµ¬ì²´ì ì¸ í–‰ë™ ë°©ì•ˆì„ íƒìƒ‰í•©ë‹ˆë‹¤.")
    display_future_solutions()
    
    st.markdown("---")
    st.info("ê¸°í›„ìœ„ê¸° ëŒ€ì‘ì€ ëª¨ë‘ì˜ ì±…ì„ì´ë©°, ì²­ì†Œë…„ë“¤ì˜ ì‘ì€ ì‹¤ì²œê³¼ í•™êµì˜ ì œë„ì  ì§€ì›ì´ ë” ë‚˜ì€ ë¯¸ë˜ë¥¼ ë§Œë“œëŠ” í•µì‹¬ ë™ë ¥ì…ë‹ˆë‹¤.")

